<!DOCTYPE html>
<html lang="PT-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trabalho Gabriel Queiroz</title>

<!-- Última versão JQUERY compilada e minificada -->
<script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
<!-- Última versão CSS compilada e minificada -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<!-- Última versão JS compilada e minificada -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  
<!-- fontawesome-->
   <script src="https://kit.fontawesome.com/15d3963f90.js" crossorigin="anonymous"></script>
</head>
<body>
    
    <h1> Registro</h1>
    <form id="FormUsuario">
        <div class="form-row col-md-6 p-3">
          <div class="form-group ">
            <label for="inputEmail4">Nome</label>
            <input type="name" class="form-control" id="nome" placeholder="Gabriel">
          </div>
          <div class="form-group ">
            <label for="inputPassword4">Descrição</label>
            <input type="text" class="form-control" id="descricao" placeholder="Estudante">
          </div>
        </div>
        <div class="form-group col-md-6 p-3">
          <label for="inputAddress">Edereço</label>
          <input type="text" class="form-control" id="endereco" placeholder="Rua albuquerque, 520">
        </div>
            <div class="form-row col-md-6 p-3">
          <div class="form-group">
            <label for="inputCity">Data Incio</label>
            <input type="date" class="form-control" id="dataincio" placeholder="01/01/2020">
          </div>
         <br>
          <div class="form-row ">
            <div class="form-group ">
              <label for="inputCity">Data Final</label>
              <input type="date" class="form-control" id="datafinal" placeholder="31/12/2020">
            </div>
          </div>
        
          
        </div>
        <button type="submit" class="btn btn-primary" id="salvar">Confirmar</button>
        </div>
        
        
        <!-- Resposta-->
        <div class="col-md-6 p-3">
          <table class="table table-striped table-hover " id="resposta">
              <tr id="campos">
                 <thead>
                  <th id="id"></th>
                  <th id = "name">Nome</th>
                  <th id="descricao">Descrição</th>
                  <th id ="endereco"> Endereco</th>
                  <th id="datainio">Data Incio</th>
                  <th id="datafinal">Data Final</th>
                  <th></th> <!-- Coluna com botoes-->
              <tr>  
              </thead>
                 <tbody>
                  <tr id="retorno">
                      <td> </td>
                      <td> </td>
                      <td> </td>
                      <td> </td>
                      <td> </td>
                      <td> </td>
                      <td class="btn td_editar text-info" ><i class="far fa-edit"></i></td> <!-- Update-->
                      <td class="btn td_excluir text-danger"> <i class="fas fa-trash-alt"></i> </td> <!-- Delete-->
                  </tr>
                 </tbody>
              
          </table>
      </div>
      <!--identificadores BD-->
      

      </form>
    </body>
    
    
    <script>
            
            botao.addEventListener('click', create)
            lista.addEventListener('click', edit)
            lista.addEventListener('click', del)
        window.onload = () => {

            const botao = document.querySelector('#botao')
            const texto = document.querySelector('#texto')
            const lista = document.querySelector('#lista')

            botao.addEventListener('click', create)

            lista.addEventListener('click', del)
            
            read()
        }
        function read() {
            lista.innerHTML = ""
 //chamada ajax na rota /read
 axios.get('/read')
 .then((response) =>{
 // console.log(response);
 response.data.forEach(element => {
 lista.innerHTML += templateLi(element.id, element.name)
 })
 })
 .catch((error) =>{
 console.log(error);
 })

        }
        function create() {

            const name = texto.value
            axios.post('/create', { name })
                .then((response) => {
                    console.log(response)
                    lista.innerHTML += templateLi(response.data[0], name)

                })
                .catch((error) => {
                    console.log(error);
                })

        }
        
        function edit() {
            if (element.target.classList.contains('update')) {
                const input = document.createElement('input')

                input.type = 'text'

                input.setAttribute('value', '')
                input.addEventListener('keydown', update.bind(pai, id, input))

                const pai = element.target.parentElement;
                const id = element.target.dataset.id

                pai.innerHTML=""
                pai.appendChild(input)
                input.addEventListener('keydown', update)
                input.focus()
            }
        }
        function update() {
            const x = event.key
            if (x == null || x != 'Enter') return

            axios.put(`/update/${id}`, { name: input.value })
                .then((response) => {
                    if (response.status = 200) {
                        this.innerHTML = templateLi(id, input.value, false)
                    }
                })
                .catch((error) => {
                    console.log(error);
                })
        }
        function del(element) {
            console.log(element)
            if (element.target.classList.contains('delete')) {
                //id do elemento a excluir?
                const id = element.target.dataset.id
                axios.delete(`/delete/${id}`)
                    .then((response) => {
                        console.log(response)
                        if (response.status = 200) {
                            lista.removeChild(element.path[1])
                        }
                    })
                    .catch((error) => {
                        console.log(error);
                    })
            }

        }
        function templateLi(id, name, element = true) {
            return `
        ${element ? `<li class="list-group-item">` : ''}
        ${name}
        <i class="btn btn-danger delete fa fa-trash"
        style="float:right; margin-left: 5px;"
        data-id="${id}"
        ></i>
        <i class="btn btn-primary update fa fa-wrench"
        style="float:right;"
        data-id="${id}"
        ></i>
        ${element ? `</li>` : ''}
        `

        }
        function update () {
            update(`/update/${id}`, {inputvalue})
                    .then((response) => {
                        console.log(response)
                        if (response.status = 200) {
                            lista.removeChild(element.path[1])
                        }
                    })
                    .catch((error) => {
                        console.log(error);
                    })
        }
    
    </script>


</html>

